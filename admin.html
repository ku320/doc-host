<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Admin Panel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f6f8;
            padding: 30px;
        }
        
        h1 {
            color: #333;
        }
        
        input,
        button {
            padding: 8px;
            margin: 5px 0;
        }
        
        button {
            cursor: pointer;
        }
        
        .card {
            background: #fff;
            padding: 15px;
            margin-top: 15px;
            border-radius: 8px;
        }
        
        .file {
            display: flex;
            justify-content: space-between;
            margin: 6px 0;
        }
    </style>
</head>

<body>

    <h1>üîê Admin Panel</h1>

    <div class="card">
        <p>GitHub Token:</p>
        <input type="password" id="token" placeholder="ghp_..." size="50">
        <br>
        <button onclick="loadDocs()">Login</button>
    </div>

    <div class="card">
        <h3>üì§ Upload Document</h3>
        <input type="file" id="fileInput">
        <br>
        <button onclick="uploadDoc()">Upload</button>
    </div>

    <div class="card">
        <h3>üìÇ Existing Documents</h3>
        <div id="docList">Not loaded</div>
    </div>

    <script>
        const OWNER = "kumar";
        const REPO = "host";
        const DOC_PATH = "documents";
        const DATA_FILE = "data.json";

        function api(path, method = "GET", body = null) {
            const token = document.getElementById("token").value;
            return fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${path}`, {
                method,
                headers: {
                    "Authorization": "token " + token,
                    "Accept": "application/vnd.github.v3+json"
                },
                body: body ? JSON.stringify(body) : null
            }).then(r => r.json());
        }

        async function loadDocs() {
            const list = document.getElementById("docList");
            list.innerHTML = "Loading...";

            const files = await api(DOC_PATH);
            list.innerHTML = "";

            files.forEach(f => {
                const div = document.createElement("div");
                div.className = "file";
                div.innerHTML = `
      <span>${f.name}</span>
      <button onclick="deleteDoc('${f.name}', '${f.sha}')">Delete</button>
    `;
                list.appendChild(div);
            });
        }

        async function uploadDoc() {
            const file = document.getElementById("fileInput").files[0];
            if (!file) return alert("Select a file");

            const reader = new FileReader();
            reader.onload = async() => {
                const content = reader.result.split(",")[1];

                await api(`${DOC_PATH}/${file.name}`, "PUT", {
                    message: "Add document " + file.name,
                    content: content
                });

                await updateData(file.name, "add");
                loadDocs();
                alert("Uploaded");
            };
            reader.readAsDataURL(file);
        }

        async function deleteDoc(name, sha) {
            if (!confirm("Delete " + name + "?")) return;

            await api(`${DOC_PATH}/${name}`, "DELETE", {
                message: "Delete document " + name,
                sha: sha
            });

            await updateData(name, "remove");
            loadDocs();
        }

        async function updateData(filename, action) {
            const data = await api(DATA_FILE);
            const decoded = JSON.parse(atob(data.content));

            if (action === "add") {
                decoded.documents.push({
                    name: filename,
                    path: `documents/${filename}`
                });
            } else {
                decoded.documents = decoded.documents.filter(d => d.name !== filename);
            }

            await api(DATA_FILE, "PUT", {
                message: "Update data.json",
                content: btoa(JSON.stringify(decoded, null, 2)),
                sha: data.sha
            });
        }
    </script>

</body>

</html>