<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #0f1115;
  color: #eaeaea;
  padding: 40px;
}
h1, h3 {
  text-align: center;
}
.card {
  background: #1b1f27;
  padding: 20px;
  margin: auto;
  max-width: 520px;
  border-radius: 10px;
  box-shadow: 0 0 12px rgba(0,0,0,0.6);
}
input, select, button {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
  background: #2a2f3a;
  color: #fff;
  border: none;
  border-radius: 6px;
}
button {
  cursor: pointer;
  font-weight: bold;
}
button:hover {
  background: #3a4150;
}
.hidden { display: none; }

.file {
  display: flex;
  justify-content: space-between;
  margin: 8px 0;
}

.progress {
  width: 100%;
  background: #333;
  border-radius: 5px;
  margin-top: 10px;
}
.progress-bar {
  height: 10px;
  width: 0%;
  background: #4caf50;
  border-radius: 5px;
}

.logout {
  background: #c0392b;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="card">
  <h1>üîê Admin Login</h1>
  <input type="password" id="tokenInput" placeholder="GitHub Access Token">
  <button onclick="login()">Login</button>
  <p id="loginMsg"></p>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="card hidden">
  <h1>‚öô Admin Dashboard</h1>

  <button onclick="showUpload()">‚¨Ü Upload Document</button>
  <button onclick="showDocs()">üìÇ All Documents</button>
  <button class="logout" onclick="logout()">Logout</button>

  <!-- UPLOAD -->
  <div id="uploadSection" class="hidden">
    <h3>Upload Document</h3>

    <select id="category">
      <option value="notes">Notes</option>
      <option value="projects">Projects</option>
      <option value="misc">Misc</option>
    </select>

    <input type="file" id="fileInput">
    <button id="uploadBtn" onclick="uploadDoc()">Upload</button>

    <div class="progress hidden" id="progressBox">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <p id="progressText"></p>
  </div>

  <!-- DOCUMENTS -->
  <div id="docsSection" class="hidden">
    <h3>All Documents</h3>
    <div id="docList">Loading...</div>
  </div>
</div>

<script>
const OWNER = "YOUR_GITHUB_USERNAME";
const REPO  = "YOUR_REPO_NAME";
const BASE  = "documents";
const DATA  = "data.json";
let TOKEN = "";

/* ---------- AUTH ---------- */
async function login() {
  TOKEN = tokenInput.value;
  loginMsg.innerText = "Checking...";

  const r = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}`, {
    headers: { Authorization: "token " + TOKEN }
  });

  if (!r.ok) return loginMsg.innerText = "Invalid token";

  login.classList.add("hidden");
  dashboard.classList.remove("hidden");
}

function logout() { location.reload(); }

/* ---------- NAV ---------- */
function showUpload() {
  uploadSection.classList.remove("hidden");
  docsSection.classList.add("hidden");
}
function showDocs() {
  uploadSection.classList.add("hidden");
  docsSection.classList.remove("hidden");
  loadDocs();
}

/* ---------- API ---------- */
function api(path, method="GET", body=null) {
  return fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${path}`, {
    method,
    headers: {
      Authorization: "token " + TOKEN,
      Accept: "application/vnd.github.v3+json"
    },
    body: body ? JSON.stringify(body) : null
  }).then(r => r.json());
}

/* ---------- DOC LIST ---------- */
async function loadDocs() {
  docList.innerHTML = "Loading...";
  const data = await api(DATA);
  const json = JSON.parse(atob(data.content));
  docList.innerHTML = "";

  json.documents.forEach(d => {
    const div = document.createElement("div");
    div.className = "file";
    div.innerHTML = `
      <span>${d.category} / ${d.name}</span>
      <button onclick="deleteDoc('${d.path}')">Delete</button>
    `;
    docList.appendChild(div);
  });
}

/* ---------- UPLOAD ---------- */
async function uploadDoc() {
  const file = fileInput.files[0];
  if (!file) return alert("Select a file");

  const category = categorySelect.value;
  const path = `${BASE}/${category}/${file.name}`;

  uploadBtn.disabled = true;
  progressBox.classList.remove("hidden");

  const reader = new FileReader();
  reader.onprogress = e => {
    if (e.lengthComputable) {
      const p = (e.loaded / e.total) * 100;
      progressBar.style.width = p + "%";
      progressText.innerText = Math.round(p) + "%";
    }
  };

  reader.onload = async () => {
    await api(path, "PUT", {
      message: "Add " + file.name,
      content: reader.result.split(",")[1]
    });

    await updateData(file.name, category, path);
    uploadBtn.disabled = false;
    progressText.innerText = "Uploaded ‚úî";
    progressBar.style.width = "100%";
    fileInput.value = "";
  };

  reader.readAsDataURL(file);
}

/* ---------- DELETE ---------- */
async function deleteDoc(path) {
  if (!confirm("Delete this file?")) return;

  const f = await api(path);
  await api(path, "DELETE", {
    message: "Delete file",
    sha: f.sha
  });

  await updateData(null, null, path, true);
  loadDocs();
}

/* ---------- data.json ---------- */
async function updateData(name, category, path, remove=false) {
  const f = await api(DATA);
  const json = JSON.parse(atob(f.content));

  if (remove) {
    json.documents = json.documents.filter(d => d.path !== path);
  } else {
    json.documents.push({ name, category, path });
  }

  await api(DATA, "PUT", {
    message: "Update data.json",
    content: btoa(JSON.stringify(json, null, 2)),
    sha: f.sha
  });
}
</script>

</body>
</html>
